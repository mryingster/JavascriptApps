<html>
  <head>
    <title>Circles</title>
    <style>
      #content {
          text-align: center;
      }
    </style>
  </head>
  <body>
    <div id="content">
      <canvas id="canvas" width="512" height="512"></canvas>
      <br>
      <button onclick="remove();">-</button>
      <button onclick="add();">+</button>
      <input type="checkbox" id="lines" name="lines" value="lines">
      <label for="lines">Lines</label>
    </div>
  </body>
  <script>

    let canvas = document.getElementById("canvas");
    let ctx = canvas.getContext("2d");
    let last_frame;
    let circles = [];
    let phase = 0;
    let max = 8;

    function draw_circle(x, y, radius, color1, color2) {
        ctx.beginPath();
        ctx.arc(x, y, radius, 0, 2 * Math.PI);
        if (color1 != 0) {
            ctx.fillStyle = color1;
            ctx.fill();
        }
        if (color2 != 0) {
            ctx.strokeStyle = color2;
            ctx.stroke();
        }
    }

    function redraw() {
        let cx = canvas.width / 2;
        let cy = canvas.height / 2;
        let r  = (canvas.width / 2) * .9;

        let show_lines = document.getElementById("lines").checked;
        if (show_lines) {
            for (let c of circles) {
                //Translate the canvas
                ctx.save()
                ctx.translate(cx, cy);

                // Rotate
                let angle = (Math.PI * 2) * (c/2);
                ctx.rotate(angle);

                ctx.strokeStyle = "#888";
                ctx.beginPath();
                ctx.moveTo(-r, 0);
                ctx.lineTo(r, 0);
                ctx.stroke();
                // Unrotate
                ctx.restore();

            }
        }

        for (let c of circles) {
            //Translate the canvas
            ctx.save()
            ctx.translate(cx, cy);

            // Rotate
            let angle = (Math.PI * 2) * (c/2);
            ctx.rotate(angle);

            // Draw stuff
            let ph = phase + (Math.PI * (c)); // Phase
            let po = Math.sin(ph) * r; // Porportion

            draw_circle(po, 0, 10, "#000", "#000");

            // Unrotate
            ctx.restore();

        }

    }

    function main_loop(timestamp) {
        if (last_frame === undefined) {
            last_frame = timestamp;
        }
        let elapsed = timestamp - last_frame;
        if (elapsed != elapsed) elapsed = 0;

        // Clear canvas
        ctx.fillStyle = "#fff";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Update phase
        phase += .001 * elapsed;

        // Redraw
        redraw();

        // Loop!
        last_frame = timestamp;
        window.requestAnimationFrame(main_loop);
    }

    function update_max() {
        circles = [];
        for (let i=0; i<max; i++) {
            circles.push(i / max);
        }
    }

    function add() {
        max += 1;
        update_max();
    }

    function remove() {
        max -= 1;
        if (max <= 0) max = 1;
        update_max();
    }

    function main() {
        update_max();
        main_loop();
    }

    main();

  </script>
</html>
