<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Mandelbrot</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" type="text/css" media="screen" href="style.css">
    <script src="interface.js"></script>
    <script src="mandelbrot.js"></script>
    <script src="/apps/shared/jscolor.js"></script>
    <meta charset="utf-8">
  </head>
  <body onresize="resize_canvas();" onload="first_run();">

    <canvas id="mandelbrot_canvas"></canvas>
    <canvas id="julia_canvas"></canvas>

    <div id="controls">
    <button id="zoom-out" class="zoom">-</button>
    <button id="zoom-in" class="zoom">+</button>
      Depth:
      <input type="range" min="1" max="512" value="214" oninput="slide_depth();" id="depthSelection">
      <span id="depth">32</span>
      Scale:
      <select onchange="rerender()" id="scaleSelection">
        <option>.25</option>
        <option>.5</option>
        <option selected="selected">1</option>
        <option>2</option>
        <option>4</option>
        <option>8</option>
      </select>
      Scheme:
      <select onchange="update_gradient()" id="scheme">
        <option selected="selected">Spectrum</option>
        <option>Red</option>
        <option>Green</option>
        <option>Blue</option>
        <option>White</option>
        <option>Sunset</option>
        <option>Random Gradient</option>
        <option>Spectrum Cycle</option>
        <option>Random Colors</option>
        <option>Zebra</option>
        <option>Set Only</option>
      </select>
      <button id="editgradient">Edit</button>
      <input type="checkbox" id="preview" name="preview" value="preview" checked /><label for="preview">Preview</label>
      <input type="checkbox" id="julia" name="julia" value="julia"><label for="julia" />Julia</label>

      <span id="share"><a href="#" id="share_link">Share Link</a></span>
      <span id="download"><a href="#" id="download_link" download="mandelbrot.png">Download PNG</a></span>
    </div>

    <div class="hidden" id="customgradient">
      <h2>Color Scheme</h2>
      <span id="close">Ã—</span>

      <br>
      Mandelbrot Color:
      <div id="mandelbrotcolordiv">
      </div>

      <hr>
      Gradient Colors:
      <div id="gradientstops">
      </div>
    <button id="add-color-stop">Add Color</button>

      <hr>
      <input type="checkbox" id="gradient" name="gradient" value="gradient" onchange="update_custom();" checked><label for="gradient" />Gradient</label>
      <input type="checkbox" id="proportional" name="proportional" value="proportional" onchange="update_custom();" checked><label for="proportional" />Proportional</label>
    </div>

    <div id="coords_div" class="note">
      Mouse Coordinates: <span id="coords">-0.19854,+1.10112</span>
    </div>

    <div id="elapsed_div" class="note">
      Render Time: <span id="elapsed">00:00.722</span>
    </div>

    <script>

let mandelbrot;
let julia;

function first_run() {
    // Bind interactive elements
    document.getElementById("zoom-out").onclick = () => { zoom(false, null); };
    document.getElementById("zoom-in").onclick = () => { zoom(true, null); };
    document.getElementById("editgradient").onclick = () => { document.getElementById('customgradient').classList.toggle('hidden'); };
    document.getElementById("julia").onclick = () => { toggle_julia(); };
    document.getElementById("download").onclick = () => { save_image(); };
    document.getElementById("close").onclick = () => { document.getElementById('customgradient').classList.add('hidden'); };
    document.getElementById("add-color-stop").onclick = () => { add_color_stop('gradientstops', '#ffffff'); };

    // Create mandelbrot classes
    julia = new Mandelbrot(
        document.getElementById("julia_canvas"),
        document.getElementById("depthSelection"),
        document.getElementById("scaleSelection"),
        document.getElementById("coords"),
        document.getElementById("preview"),
        256,
        256,
        "julia",
        false,
        null,
    );

    toggle_julia();
    let julia_callback = (x, y) => { julia.recenter(x, y); };

    mandelbrot = new Mandelbrot(
        document.getElementById("mandelbrot_canvas"),
        document.getElementById("depthSelection"),
        document.getElementById("scaleSelection"),
        document.getElementById("coords"),
        document.getElementById("preview"),
        512,
        512,
        "mandelbrot",
        true,
        julia_callback
    );

    resize_canvas()

    // Check if the URL contains coordinates
    let url = window.location.href;
    if (url.indexOf('?') > -1) {
        let coords = url.split('?')[1];
        let x = Number(coords.split(":")[0]);
        let y = Number(coords.split(":")[1]);
        let z = Number(coords.split(":")[2]);
        let d = Number(coords.split(":")[3]);

        if (!isNaN(x) && !isNaN(y)) {
            mandelbrot.recenter(x, y);
	    julia.recenter(x, y);
	}

        if (!isNaN(z))
            mandelbrot.zoom = z;

        if (!isNaN(d))
            set_slider(d);
    }

    mandelbrot.resize_canvas();
    update_gradient();
}


    </script>
  </body>
</html>
