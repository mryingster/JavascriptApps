<!DOCTYPE html>
<html class=" ejfrd idc0_343"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Icon</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" media="screen" href="style.css">
  </head>

  <!--
      To-dos

      1. Lasso marquee
      2. Undo - Done
      2.1 copy/paste
      3. Menus?
      4. Drag image to mask
      5. Save using local storage - Done
  -->

  <body>
    <script src="jscolor.js"></script>

    <button id="export">Export</button>
    <input type="file" id="load">
    <br>
    <button onclick="debug();">Test</button>
    <button id="maskify" onclick="update_mask();">Update Mask</button>

    <div id="content">
      <div id="tools"></div>

      <button id="background" class="jscolor {value:'#ffffff', position:'bottom', paletteCols:13, hideOnPaletteClick:true}"></button>
      <button id="foreground" class="jscolor {value:'#000000', position:'bottom', paletteCols:13, hideOnPaletteClick:true}"></button>

      <canvas tabindex='1' class="artboard" id="canvas_color"></canvas>
      <canvas tabindex='1' class="artboard" id="canvas_mask"></canvas>

      <canvas class="preview thirtytwo" id="icon_composite"></canvas>
      <canvas class="color thirtytwo"   onclick='select("color");' id="icon_color"></canvas>
      <canvas class="mask thirtytwo"    onclick='select("mask");'  id="icon_mask"></canvas>
    </div>

    <script>
// Comment

class artboard {
    constructor(canvas, icon, fgcolor, bgcolor, icon_size, tools, default_color){
	// Constants
	this.canvas  = canvas;
	this.icon    = icon;
	this.tools   = tools;
	this.foreground_color = fgcolor;
	this.background_color = bgcolor;
        this.default_color = default_color;

	// Artboard settings
	this.icon_size		= icon_size;
	this.square_size	= 7;
	this.border_size	= 1;
	this.width		= this.icon_size * (this.square_size + this.border_size) + this.border_size;
	this.height		= this.icon_size * (this.square_size + this.border_size) + this.border_size;
	this.artboard_ctx	= canvas.getContext("2d");
	this.icon_ctx		= icon.getContext("2d");

	// Set canvas size
	this.canvas.width	= this.width;
	this.canvas.height	= this.height;
	this.icon.width         = icon_size;
	this.icon.height        = icon_size;

	this.update_preview     = null;
        this.command_down       = false;

	// State
	this.state = {
	    "artboard_array"      : this.initialize_2d_array(this.icon_size, this.icon_size, this.default_color),
	    "prev_artboard_array" : this.initialize_2d_array(this.icon_size, this.icon_size, this.default_color),
	    "actual_color"        : null,
	    "mouse_down"          : false,
	    "mouse_down_pos"      : {x:null, y:null},
	};

        this.history = [];

	this.selection = {
	    "selected"          : false,
	    "moved"             : false,
	    "original_artboard" : null,
	    "start_coords"      : {x0:null, y0:null, x1:null, y1:null},
	    "end_coords"        : {x0:null, y0:null, x1:null, y1:null},
	    "blink_position"    : 0,
	    "timer"             : null,
	};

        // See if local storage has anything to load
        this.load_from_local_storage();

	// Listeners
	this.canvas.addEventListener('mousedown', function(e){
	    let pos = this.getCursorPosition(canvas, e)

            // Record canvas before editing for undo information
            this.record();

	    // Record our click position, but only if the mouse thinks it isn't already down
	    if (this.state.mouse_down != true)
		this.state.mouse_down_pos = pos;

	    if (this.tools.selected == "marquee")
		this.mouse_down_marquee(pos);
	    clearTimeout(this.selection.timer);

	    this.action(pos);
	    this.state.mouse_down = true;
	}.bind(this))

	this.canvas.addEventListener('mousemove', function(e) {
	    if (this.state.mouse_down == true) {
		let pos = this.getCursorPosition(canvas, e)
		this.action(pos);
	    }
	}.bind(this))

	this.canvas.addEventListener('mouseleave', function(e) {
	    this.state.mouse_down = false;
	    this.state.use_bg_color = false;
	    this.state.prev_artboard_array = JSON.parse(JSON.stringify(this.state.artboard_array));
            this.save_to_local_storage();

	    if (this.tools.selected == "marquee")
		this.mouse_up_marquee();
	}.bind(this))

	this.canvas.addEventListener('mouseup', function(e) {
	    this.state.mouse_down = false;
	    this.state.use_bg_color = false;
	    this.state.prev_artboard_array = JSON.parse(JSON.stringify(this.state.artboard_array));
            this.save_to_local_storage();

	    if (this.tools.selected == "marquee")
		this.mouse_up_marquee();
	}.bind(this))

        // Keyboard Listeners
        this.canvas.addEventListener('keydown', function(e) {
            if (e.key == "Meta" || e.key == "Control")
                this.command_down == true;
            if (e.key == "z")
                this.undo();
            //console.log(e);
        }.bind(this));

        this.canvas.addEventListener('keyup', function(e) {
            if (e.key == "Meta" || e.key == "Control")
                this.command_down == false;
            //console.log(e);
        }.bind(this));

	this.redraw_canvas();
    }

    replace_artboard_array(a) {
        // Save what we have so we can undo
        this.record();

        // Load new array
        this.state.artboard_array = a;

        // Update local storage
        this.save_to_local_storage();

        // Redraw!
        this.redraw_canvas();
    }

    record() {
        this.history.push(this.initialize_2d_array(this.icon_size, this.icon_size, this.default_color));
        this.history[this.history.length - 1] = JSON.parse(JSON.stringify(this.state.artboard_array));
    }

    save_to_local_storage() {
        localStorage[this.icon.id] = JSON.stringify(this.state.artboard_array);
    }

    load_from_local_storage() {
        let previous_session = localStorage.getItem(this.icon.id);
        if (previous_session != null) {
            this.state.prev_artboard_array = JSON.parse(previous_session);
            this.state.artboard_array = JSON.parse(previous_session);
            this.redraw_canvas();
        }
    }

    mouse_down_marquee(pos){
	// If nothing is yet selected, record the position for start of selection box
	if (this.selection.selected == false){
	    this.selection.original_artboard = JSON.parse(JSON.stringify(this.state.artboard_array));
	    this.selection.start_coords.x0 = pos.x;
	    this.selection.start_coords.y0 = pos.y;
	}
	this.selection.moved = false;

	// Check if we clicked out of the selection area
	if (this.selection.selected == true){
	    if (pos.x < this.selection.start_coords.x0 ||
		pos.x > this.selection.start_coords.x1 ||
		pos.y < this.selection.start_coords.y0 ||
		pos.y > this.selection.start_coords.y1){
		this.selection.selected = false;
		this.selection.start_coords.x0 = pos.x;
		this.selection.start_coords.y0 = pos.y;
	    }
	}
    }

    mouse_up_marquee(){
	if (this.selection.selected == false)
	    this.selection.selected = true;

	// Check to make sure smaller coords in x0/y0
	if (this.selection.start_coords.y0 > this.selection.start_coords.y1){
	    let t = this.selection.start_coords.y1;
	    this.selection.start_coords.y1 = this.selection.start_coords.y0;
	    this.selection.start_coords.y0 = t;
	}
	if (this.selection.start_coords.x0 > this.selection.start_coords.x1){
	    let t = this.selection.start_coords.x1;
	    this.selection.start_coords.x1 = this.selection.start_coords.x0;
	    this.selection.start_coords.x0 = t;
	}

	// See if the selection area has moved at all
	if (this.selection.moved == true){
	    this.selection.original_artboard = JSON.parse(JSON.stringify(this.state.artboard_array));
	    this.selection.start_coords = {...this.selection.end_coords};
	    // Check to see if the coords are out of bounds, and shrink them
	    this.selection.start_coords.y0 = Math.max(this.selection.start_coords.y0, 0);
	    this.selection.start_coords.y1 = Math.min(this.selection.start_coords.y1, this.state.artboard_array.length -1);
	    this.selection.start_coords.x0 = Math.max(this.selection.start_coords.x0, 0);
	    this.selection.start_coords.x1 = Math.min(this.selection.start_coords.x1, this.state.artboard_array.length -1);
	}

	// Check if selection contains nothing, deselect
	if (this.selection.start_coords.y0 == this.selection.start_coords.y1 ||
	    this.selection.start_coords.x0 == this.selection.start_coords.x1){
	    this.selection.selected = false;
	    this.state.artboard_array = JSON.parse(JSON.stringify(this.selection.original_artboard));
	    this.redraw_canvas();
	}

	// Animate if something is still selected
	if (this.selection.selected == true)
	    this.animate_marquee();
    }

    initialize_2d_array(x, y, c){
	let new_array = [];
	while (new_array.length < y){
	    let new_row = [];
	    while (new_row.length < x){
		new_row.push(c);
	    }
	    new_array.push(new_row);
	}
	return new_array;
    }

    getCursorPosition(canvas, event){
	// Determine where clicked
	const rect = canvas.getBoundingClientRect()
	const realx = event.clientX - rect.left
	const realy = event.clientY - rect.top

	// Determine square size
	var pixelx = Math.floor(realx/(this.square_size + this.border_size));
	var pixely = Math.floor(realy/(this.square_size + this.border_size));

	return {x:pixelx, y:pixely};
    }

    animate_marquee(){
	// Undo the previously drawn box
	this.state.artboard_array = JSON.parse(JSON.stringify(this.selection.original_artboard));
	//this.undo();

	// Draw blinking outline
	let position1 = this.selection.blink_position % 6;
	let position2 = this.selection.blink_position % 6;
	let position3 = this.selection.blink_position % 6;
	let position4 = this.selection.blink_position++ % 6;

	for(let x=Math.min(this.selection.start_coords.x0, this.selection.start_coords.x1); x<=Math.max(this.selection.start_coords.x0, this.selection.start_coords.x1); x++)
	    if (position1++ % 6 < 3)
		this.state.artboard_array[this.selection.start_coords.y0][x] = "#000000";
	for(let x=Math.max(this.selection.start_coords.x0, this.selection.start_coords.x1); x>=Math.min(this.selection.start_coords.x0, this.selection.start_coords.x1); x--)
	    if (position2++ % 6 < 3)
		this.state.artboard_array[this.selection.start_coords.y1][x] = "#000000";
	for(let y=Math.min(this.selection.start_coords.y0, this.selection.start_coords.y1); y<=Math.max(this.selection.start_coords.y0, this.selection.start_coords.y1); y++)
	    if (position3++ % 6 < 3)
		this.state.artboard_array[y][this.selection.start_coords.x1] = "#000000";
	for(let y=Math.max(this.selection.start_coords.y0, this.selection.start_coords.y1); y>=Math.min(this.selection.start_coords.y0, this.selection.start_coords.y1); y--)
	    if (position4++ % 6 < 3)
		this.state.artboard_array[y][this.selection.start_coords.x0] = "#000000";

	this.redraw_canvas();
	this.selection.timer = setTimeout(() => this.animate_marquee(), 250);
    }

    recurse(x, y, cc, nc){
	if (cc == nc) return;
	if (this.state.artboard_array[y][x].toLowerCase() != cc.toLowerCase()) return;
	this.state.artboard_array[y][x] = nc;
	if (x+1 < this.icon_size)
	    this.recurse(x+1, y, cc, nc);
	if (x-1 >= 0)
	    this.recurse(x-1, y, cc, nc);
	if (y+1 < this.icon_size)
	    this.recurse(x, y+1, cc, nc);
	if (y-1 >= 0)
	    this.recurse(x, y-1, cc, nc);
    }

    fg_color(){
	return this.foreground_color.jscolor.toHEXString();
    }

    bg_color(){
	return this.background_color.jscolor.toHEXString();
    }

    plot_line_low(x0, y0, x1, y1){
    	let dx = x1 - x0;
	let dy = y1 - y0;
	let yi = 1;
	if (dy < 0) {
	    yi = -1;
	    dy *= -1;
	}
	let D  = (2.0 * dy) - dx;
	let y  = y0;

	for (let x=x0; x<=x1; x++) {
	    this.state.artboard_array[y][x] = this.fg_color();

	    if (D > 0) {
		y += yi;
		D = D + (2 * (dy-dx));
	    } else {
		D = D + (2 * dy);
	    }
	}

	return;
    }

    plot_line_high(x0, y0, x1, y1){
    	let dx = x1 - x0;
	let dy = y1 - y0;
	let xi = 1;
	if (dx < 0) {
	    xi = -1;
	    dx *= -1;
	}
	let D  = (2.0 * dx) - dy;
	let x  = x0;

	for (let y=y0; y<=y1; y++) {
	    this.state.artboard_array[y][x] = this.fg_color();

	    if (D > 0) {
		x += xi;
		D = D + (2 * (dx-dy));
	    } else {
		D = D + (2 * dx);
	    }
	}

	return;
    }

    plot_ellipse(rx, ry, xc, yc){
	let x = 0.0;
	if (rx % 1 != 0) x+=.5; // Workaround for not working on 1/2 radius lengths?
	let y = ry * 1.0;

	// Initial decision parameter of region 1
	let d1 = (ry * ry) - (rx * rx * ry) + (0.25 * rx * rx);
	let dx = 2.0 * ry * ry * x;
	let dy = 2.0 * rx * rx * y;

	// For region 1
	while (dx < dy) {

	    // Color perimeter with 4 way symmetry
	    this.state.artboard_array[y+yc][x+xc] = this.fg_color();
	    this.state.artboard_array[y+yc][-x+xc] = this.fg_color();
	    this.state.artboard_array[-y+yc][x+xc] = this.fg_color();
	    this.state.artboard_array[-y+yc][-x+xc] = this.fg_color();

	    // Checking and updating value of
	    // decision parameter based on algorithm
	    if (d1 < 0) {
		x++;
		dx = dx + (2 * ry * ry);
		d1 = d1 + dx + (ry * ry);
	    } else {
		x++;
		y--;
		dx = dx + (2 * ry * ry);
		dy = dy - (2 * rx * rx);
		d1 = d1 + dx - dy + (ry * ry);
	    }
	}

	// Decision parameter of region 2
	let d2 = ((ry * ry) * ((x + 0.5) * (x + 0.5))) +
	    ((rx * rx) * ((y - 1) * (y - 1))) -
	    (rx * rx * ry * ry);

	// Plotting points of region 2
	while (y >= 0) {

	    // Color perimeter with 4 way symmetry
	    this.state.artboard_array[y+yc][x+xc] = this.fg_color();
	    this.state.artboard_array[y+yc][-x+xc] = this.fg_color();
	    this.state.artboard_array[-y+yc][x+xc] = this.fg_color();
	    this.state.artboard_array[-y+yc][-x+xc] = this.fg_color();

	    // Checking and updating parameter
	    // value based on algorithm
	    if (d2 > 0) {
		y--;
		dy = dy - (2 * rx * rx);
		d2 = d2 + (rx * rx) - dy;
	    } else {
		y--;
		x++;
		dx = dx + (2 * ry * ry);
		dy = dy - (2 * rx * rx);
		d2 = d2 + dx - dy + (rx * rx);
	    }
	}
    }

    action(pos){
	// Make sure pos isn't out of bounds
	if (pos.x >= this.icon_size || pos.y >= this.icon_size) return;

	// Pencil Action
	if (this.tools.selected == "pencil"){
	    // If you just clicked, check if you are actually going to draw white
	    if (this.state.mouse_down == false)
		if (this.state.artboard_array[pos.y][pos.x] == this.fg_color())
		    this.state.use_bg_color = true;

	    if (this.state.use_bg_color == true)
		this.state.artboard_array[pos.y][pos.x] = this.bg_color();
	    else
		this.state.artboard_array[pos.y][pos.x] = this.fg_color();
	}

	// Eraser Action
	if (this.tools.selected == "eraser"){
	    this.state.artboard_array[pos.y][pos.x] = "#ffffff";
	    if (pos.y+1 < this.state.artboard_array.length)
		this.state.artboard_array[pos.y+1][pos.x] = "#ffffff";
	    if (pos.x+1 < this.state.artboard_array[0].length)
		this.state.artboard_array[pos.y][pos.x+1] = "#ffffff";
	    if (pos.y+1 < this.state.artboard_array.length && pos.x+1 < this.state.artboard_array[0].length)
		this.state.artboard_array[pos.y+1][pos.x+1] = "#ffffff";
	}

	// Paint Bucket Action
	if (this.tools.selected == "paint_bucket"){
	    let current_color = this.state.artboard_array[pos.y][pos.x];
	    this.recurse(pos.x, pos.y, current_color, this.fg_color());
	}

	// Nothing Button
	if (this.tools.selected == "nothing"){
	}

	// Eyedropper tool
	if (this.tools.selected == "eyedropper"){
	    this.foreground_color.jscolor.fromString(this.state.artboard_array[pos.y][pos.x]);
	}

	// Filled Rectangle Action
	if (this.tools.selected == "filled_rect"){
	    // Undo the previously drawn box
	    this.revert();

	    for(let x=Math.min(this.state.mouse_down_pos.x, pos.x); x<=Math.max(this.state.mouse_down_pos.x, pos.x); x++){
		for(let y=Math.min(this.state.mouse_down_pos.y, pos.y); y<=Math.max(this.state.mouse_down_pos.y, pos.y); y++){
		    this.state.artboard_array[y][x] = this.fg_color();
		}
	    }
	}

	// Empty Rectangle Action
	if (this.tools.selected == "empty_rect"){
	    // Undo the previously drawn box
	    this.revert();

	    for(let x=Math.min(this.state.mouse_down_pos.x, pos.x); x<=Math.max(this.state.mouse_down_pos.x, pos.x); x++){
		this.state.artboard_array[pos.y][x] = this.fg_color();
		this.state.artboard_array[this.state.mouse_down_pos.y][x] = this.fg_color();
	    }
	    for(let y=Math.min(this.state.mouse_down_pos.y, pos.y); y<=Math.max(this.state.mouse_down_pos.y, pos.y); y++){
		this.state.artboard_array[y][pos.x] = this.fg_color();
		this.state.artboard_array[y][this.state.mouse_down_pos.x] = this.fg_color();
	    }
	}

	// Marquee Action
	if (this.tools.selected == "marquee"){
	    // Redraw from stored state of canvas
	    this.state.artboard_array = JSON.parse(JSON.stringify(this.selection.original_artboard));

	    // If we have no selection, draw selection box
	    if (this.selection.selected == false){
		for(let x=Math.min(this.state.mouse_down_pos.x, pos.x); x<=Math.max(this.state.mouse_down_pos.x, pos.x); x++){
		    this.state.artboard_array[pos.y][x] = "#000000";
		    this.state.artboard_array[this.state.mouse_down_pos.y][x] = "#000000";
		}
		for(let y=Math.min(this.state.mouse_down_pos.y, pos.y); y<=Math.max(this.state.mouse_down_pos.y, pos.y); y++){
		    this.state.artboard_array[y][pos.x] = "#000000";
		    this.state.artboard_array[y][this.state.mouse_down_pos.x] = "#000000";
		}

		this.selection.start_coords.x1 = pos.x;
		this.selection.start_coords.y1 = pos.y;

		// If we have a selection...
	    } else {
		// See if click is not previously selected area. Draw a new box...

		// Fill the original selection area with background color
		for(let x=Math.min(this.selection.start_coords.x0, this.selection.start_coords.x1); x<=Math.max(this.selection.start_coords.x0, this.selection.start_coords.x1); x++){
		    for(let y=Math.min(this.selection.start_coords.y0, this.selection.start_coords.y1); y<=Math.max(this.selection.start_coords.y0, this.selection.start_coords.y1); y++){
			this.state.artboard_array[y][x] = this.bg_color();
		    }
		}

		// get the x and y offsets from the move
		let dx = this.state.mouse_down_pos.x - pos.x;
		let dy = this.state.mouse_down_pos.y - pos.y;

		// Draw the selected area in the new location
		for(let x=Math.min(this.selection.start_coords.x0, this.selection.start_coords.x1); x<=Math.max(this.selection.start_coords.x0, this.selection.start_coords.x1); x++){
		    for(let y=Math.min(this.selection.start_coords.y0, this.selection.start_coords.y1); y<=Math.max(this.selection.start_coords.y0, this.selection.start_coords.y1); y++){
			if (y-dy < 0 || y-dy > this.state.artboard_array.length-1) continue;
			if (x-dx < 0 || x-dx > this.state.artboard_array[0].length-1) continue;
			this.state.artboard_array[y-dy][x-dx] = this.selection.original_artboard[y][x];
		    }
		}

		// Indicate that we've moved and record the new coords
		this.selection.moved = true;
		this.selection.end_coords.x0 = this.selection.start_coords.x0 - dx;
		this.selection.end_coords.x1 = this.selection.start_coords.x1 - dx;
		this.selection.end_coords.y0 = this.selection.start_coords.y0 - dy;
		this.selection.end_coords.y1 = this.selection.start_coords.y1 - dy;
	    }
	}

	// Filled Rounded Rectangle Action
	if (this.tools.selected == "filled_round_rect"){
	    // Undo the previously drawn box
	    this.revert();

	    for(let x=Math.min(this.state.mouse_down_pos.x, pos.x); x<=Math.max(this.state.mouse_down_pos.x, pos.x); x++){
		for(let y=Math.min(this.state.mouse_down_pos.y, pos.y); y<=Math.max(this.state.mouse_down_pos.y, pos.y); y++){
		    // Skip corner cases
		    if (
			// Vertical corners
			x == pos.x && ( y >= pos.y-2 && y <= pos.y+2 ) ||
			x == pos.x && ( y >= this.state.mouse_down_pos.y-2 && y <= this.state.mouse_down_pos.y+2 ) ||
			x == this.state.mouse_down_pos.x && ( y >= pos.y-2 && y <= pos.y+2 ) ||
			x == this.state.mouse_down_pos.x && ( y >= this.state.mouse_down_pos.y-2 && y <= this.state.mouse_down_pos.y+2 ) ||

			// Horizontal corners
			y == pos.y && ( x >= pos.x-2 && x <= pos.x+2 ) ||
			y == pos.y && ( x >= this.state.mouse_down_pos.x-2 && x <= this.state.mouse_down_pos.x+2 ) ||
			y == this.state.mouse_down_pos.y && ( x >= pos.x-2 && x <= pos.x+2 ) ||
			y == this.state.mouse_down_pos.y && ( x >= this.state.mouse_down_pos.x-2 && x <= this.state.mouse_down_pos.x+2 )
		    ) continue;
		    this.state.artboard_array[y][x] = this.fg_color();
		}
	    }
	}

	// Empty Rounded Rectangle Action
	if (this.tools.selected == "empty_round_rect"){
	    // Undo the previously drawn box
	    this.revert();

	    for(let x=Math.min(this.state.mouse_down_pos.x, pos.x); x<=Math.max(this.state.mouse_down_pos.x, pos.x); x++){
		if ( (x >= pos.x-2 && x <= pos.x+2) || (x >= this.state.mouse_down_pos.x-2 && x <= this.state.mouse_down_pos.x+2) ){
		    if ( x != pos.x && x != this.state.mouse_down_pos.x ){
			if (pos.y < this.state.mouse_down_pos.y){
			    this.state.artboard_array[pos.y+1][x] = this.fg_color();
			    this.state.artboard_array[this.state.mouse_down_pos.y-1][x] = this.fg_color();
			} else {
			    this.state.artboard_array[pos.y-1][x] = this.fg_color();
			    this.state.artboard_array[this.state.mouse_down_pos.y+1][x] = this.fg_color();
			}
		    }
		} else {
		    this.state.artboard_array[pos.y][x] = this.fg_color();
		    this.state.artboard_array[this.state.mouse_down_pos.y][x] = this.fg_color();
		}
	    }

	    for(let y=Math.min(this.state.mouse_down_pos.y, pos.y); y<=Math.max(this.state.mouse_down_pos.y, pos.y); y++){
		if ( (y >= pos.y-2 && y <= pos.y+2) || (y >= this.state.mouse_down_pos.y-2 && y <= this.state.mouse_down_pos.y+2) ){
		    if ( y != pos.y && y != this.state.mouse_down_pos.y ){
			if (pos.x < this.state.mouse_down_pos.x){
			    this.state.artboard_array[y][pos.x+1] = this.fg_color();
			    this.state.artboard_array[y][this.state.mouse_down_pos.x-1] = this.fg_color();
			} else {
			    this.state.artboard_array[y][pos.x-1] = this.fg_color();
			    this.state.artboard_array[y][this.state.mouse_down_pos.x+1] = this.fg_color();
			}
		    }
		} else {
		    this.state.artboard_array[y][pos.x] = this.fg_color();
		    this.state.artboard_array[y][this.state.mouse_down_pos.x] = this.fg_color();
		}
	    }
	}

	// Line Action
	if (this.tools.selected == "line"){
	    // Undo the previously drawn line
	    this.revert();

	    let x0 = this.state.mouse_down_pos.x;
	    let x1 = pos.x;
	    let y0 = this.state.mouse_down_pos.y;
	    let y1 = pos.y;

	    if (Math.abs(y1 - y0) < Math.abs(x1 - x0)) {
		if (x0 > x1)
		    this.plot_line_low(x1, y1, x0, y0)
		else
		    this.plot_line_low(x0, y0, x1, y1)
	    } else {
		if (y0 > y1)
		    this.plot_line_high(x1, y1, x0, y0)
		else
		    this.plot_line_high(x0, y0, x1, y1)
	    }
	}

	// Empty Oval Action
	if (this.tools.selected == "empty_oval" || this.tools.selected == "filled_oval"){
	    // Undo the previously drawn line
	    this.revert();

	    let radius_x = Math.abs(this.state.mouse_down_pos.x - pos.x) / 2;
	    let radius_y = Math.abs(this.state.mouse_down_pos.y - pos.y) / 2;
	    let center_x = Math.min(this.state.mouse_down_pos.x, pos.x) + radius_x;
	    let center_y = Math.min(this.state.mouse_down_pos.y, pos.y) + radius_y;

	    this.plot_ellipse(radius_x, radius_y, center_x, center_y);

	    if (this.tools.selected == "filled_oval")
		for (let rx = 0; rx<radius_x; rx+=1)
		    this.plot_ellipse(rx + (radius_x % 1), radius_y, center_x, center_y);
	}

	this.redraw_canvas();
    }

    undo(){
        if (this.history.length > 0) {
            this.state.artboard_array = JSON.parse(JSON.stringify(this.history[this.history.length - 1]));
            this.redraw_canvas();
            this.history.pop();
        }
    }

    revert(){
	this.state.artboard_array = JSON.parse(JSON.stringify(this.state.prev_artboard_array));
	this.redraw_canvas();
    }

    redraw_canvas(){
	for (let y=0; y<this.state.artboard_array.length; y++)
	    for (let x=0; x<this.state.artboard_array[y].length; x++)
		this.draw_pixel({x:x, y:y}, this.state.artboard_array[y][x]);

	if (this.update_preview != null)
	    this.update_preview();
    }

    draw_pixel(pos, color){
	let pixel_left = pos.x * (this.square_size + this.border_size) + this.border_size;
	let pixel_top  = pos.y * (this.square_size + this.border_size) + this.border_size;

	// Draw on the artboard
	this.artboard_ctx.fillStyle = color;
	this.artboard_ctx.fillRect(pixel_left, pixel_top, this.square_size, this.square_size);

	// Draw on the pixel preview
	this.icon_ctx.fillStyle = color;
	this.icon_ctx.fillRect(pos.x, pos.y, 1, 1);
    }
}

class toolbox{
    constructor(div){
	this.div = div;
	this.cursors = {
	    pencil     : "url(https://home.yingster.net/apps/resedit/cursors/pencil.png)      0 15, default",
	    crosshair  : "url(https://home.yingster.net/apps/resedit/cursors/crosshair.png)   6  6, crosshair",
	    eraser     : "url(https://home.yingster.net/apps/resedit/cursors/eraser.png)      3  3, default",
	    eyedropper : "url(https://home.yingster.net/apps/resedit/cursors/eyedropper.png)  1 15, default",
	    bucket     : "url(https://home.yingster.net/apps/resedit/cursors/bucket.png)     13 15, default",
	    default    : "default"
	};

	this.tools = {
	    "lasso"		: this.cursors.pencil,
	    "marquee"		: this.cursors.crosshair,
	    "eraser"		: this.cursors.eraser,
	    "pencil"		: this.cursors.pencil,
	    "eyedropper"	: this.cursors.eyedropper,
	    "paint_bucket"	: this.cursors.bucket,
	    "nothing"           : this.cursors.default,
	    "line"		: this.cursors.pencil,
	    "filled_rect"	: this.cursors.crosshair,
	    "empty_rect"	: this.cursors.crosshair,
	    "filled_round_rect"	: this.cursors.crosshair,
	    "empty_round_rect"	: this.cursors.crosshair,
	    "filled_oval"	: this.cursors.crosshair,
	    "empty_oval"	: this.cursors.crosshair,
	};

	this.selected = null;

	for (var tool in this.tools) ((tool) => {
	    let button = document.createElement('button');
	    button.classList.add("tool");
	    button.onclick = function(){this.select(tool)}.bind(this);
	    button.id=tool;
	    this.div.appendChild(button);
	})(tool)
    }

    select(t){
	for (var tool in this.tools){
	    var button = document.getElementById(tool);
	    button.classList.remove("selected");
	    if(tool == t){
		// Select tool
		button.classList.add("selected");
		this.selected = tool;

		// Change Cursor
		if (this.tools[tool] != null)
		    for (let a of document.getElementsByClassName("artboard"))
			a.style.cursor = this.tools[tool];
	    }
	}
    }
}

class render_icon {
    constructor(canvas, image, mask){
	this.canvas = canvas;
	this.ctx    = this.canvas.getContext("2d");
	this.image  = image;
	this.mask   = mask;

	this.canvas.height = this.image.state.artboard_array.length;
	this.canvas.width  = this.image.state.artboard_array[0].length;

	this.render();
    }

    string_to_rgb(s){
	let r = parseInt(s.substring(1,3), 16);
	let g = parseInt(s.substring(3,5), 16);
	let b = parseInt(s.substring(5,7), 16);
	return {r:r, g:g, b:b};
    }

    rgb_to_alpha(c){
	let a = this.string_to_rgb(c);
	return Math.max(a.r, a.g, a.b)/255.0
    }

    convert_to_rgba(color, alpha){
	let a = 1 - this.rgb_to_alpha(alpha);
	let c = this.string_to_rgb(color);

	return "rgba("+c.r+", "+c.g+", "+c.b+", "+a+")";
    }

    clear(){
	this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
    }

    render(){
	this.clear();

	let icon = this.image.state.artboard_array;
	let mask = this.mask.state.artboard_array;

	for (let y=0; y<icon.length; y++)
	    for (let x=0; x<icon[y].length; x++){
		this.ctx.fillStyle = this.convert_to_rgba(icon[y][x], mask[y][x]);
		this.ctx.fillRect(x, y, 1, 1);
	    }
    }

    export(){
	window.open(this.canvas.toDataURL('image/png'));
    }
}

var tools = new toolbox(
    document.getElementById('tools')
);

tools.select("pencil");

var Icon32Bit = new artboard(
    document.getElementById('canvas_color'),	// Artboard
    document.getElementById('icon_color'),	// Icon
    document.getElementById('foreground'),	// Foreground color
    document.getElementById('background'),	// Background color
    32,						// Size
    tools,					// Tool thing
    '#ffffff'
);

var IconMask  = new artboard(
    document.getElementById('canvas_mask'),
    document.getElementById('icon_mask'),
    document.getElementById('foreground'),	// Foreground color
    document.getElementById('background'),	// Background color
    32,
    tools,					// Tool thing
    '#000000'
);

let preview = new render_icon(
    document.getElementById("icon_composite"),
    Icon32Bit,
    IconMask,
);

Icon32Bit.update_preview = () => {preview.render()};
IconMask.update_preview = () => {preview.render()};

document.getElementById("export").onclick = () => { preview.export() };
document.getElementById('load').addEventListener('change', load, false);

function hex(n, l=2){
    s = n.toString(16);
    while (s.length < l)
	s = "0"+s;
    return s;
}

function data_to_string(r, g, b, i){
    if (i){
	r = 255-r;
	g = 255-g;
	b = 255-b;
    }
    return "#" + hex(r) + hex(g) + hex(b);
}

function load(e){
    // clear main canvas temporarily
    let tmp_ctx = Icon32Bit.artboard_ctx
    tmp_ctx.clearRect(0, 0, 32, 32);

    // Get image from user & Load it into main canvas
    var reader = new FileReader();
    reader.onload = function(event){
        var img = new Image();
        img.onload = function(){
            tmp_ctx.drawImage(img, 0, 0);

	    // Read back from canvas to get image data format
	    var image_data = tmp_ctx.getImageData(0, 0, 32, 32);
	    var pixels = image_data.data;

	    // Convert pixels; crop to 32x32
	    let icon_array = [];
	    let mask_array = [];

	    let icon_row = [];
	    let mask_row = [];
	    for (let p=0; p<pixels.length; p+=4){
		icon_row.push(data_to_string(pixels[p+0], pixels[p+1], pixels[p+2], false));
		mask_row.push(data_to_string(pixels[p+3], pixels[p+3], pixels[p+3], true));

		if (icon_row.length == 32){
		    icon_array.push(icon_row);
		    mask_array.push(mask_row);
		    icon_row = [];
		    mask_row = [];
		}
	    }

	    // Clear canvas
	    tmp_ctx.clearRect(0, 0, Icon32Bit.canvas.width, Icon32Bit.canvas.height);

	    // Load data into states
	    Icon32Bit.replace_artboard_array(icon_array);
	    IconMask.replace_artboard_array(mask_array);
        }
        img.src = event.target.result;
    }
    reader.readAsDataURL(e.target.files[0]);
}

function select(s){
    let palette = '#ffffdf #ffdfbb #dfbb92 #ff925f #5effbb #00d300 #5fbb92 #5f9292 #bbffff #00bbff #0000ea #5f00bb #dfdfff #bbbbff #9292df #5f5f92 #ff92df #bb0092 #bb92bb #ffffff #f5f5f5 #eaeaea #dfdfdf #d3d3d3 #c7c7c7 #aeaeae #a0a0a0 #828282 #717171 #484848 #2c2c2c #000000 #ffff00 #ea0000';

    if (s == "color"){
	document.getElementById("canvas_color").classList.remove("hidden");
	document.getElementById("icon_color").classList.add("selected");
	document.getElementById("canvas_mask").classList.add("hidden");
	document.getElementById("icon_mask").classList.remove("selected");
    }
    if (s == "mask"){
	document.getElementById("canvas_mask").classList.remove("hidden");
	document.getElementById("icon_mask").classList.add("selected");
	document.getElementById("canvas_color").classList.add("hidden");
	document.getElementById("icon_color").classList.remove("selected");

	palette = '#ffffff #f5f5f5 #eaeaea #dfdfdf #d3d3d3 #c7c7c7 #aeaeae #a0a0a0 #828282 #717171 #484848 #2c2c2c #000000';
    }

    document.getElementById("foreground").jscolor.set__palette(palette);
    document.getElementById("background").jscolor.set__palette(palette);
}

select("color");

function update_mask() {
    let new_mask = [];

    for (var y=0; y<Icon32Bit.state.artboard_array.length; y++) {
        let new_mask_line = [];
        for (var x=0; x<Icon32Bit.state.artboard_array[y].length; x++) {
            if (["#ffffff", "#FFFFFF"].includes(Icon32Bit.state.artboard_array[y][x])) {
                new_mask_line.push("#FFFFFF");
            } else {
                new_mask_line.push("#000000");
            }
        }
        new_mask.push(new_mask_line);
    }

    IconMask.replace_artboard_array(new_mask);
}

// Ignore me...

function debug(){
    Icon32Bit.replace_artboard_array([
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#EA0000","#EA0000","#EA0000","#EA0000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#EA0000","#EA0000","#EA0000","#EA0000","#EA0000","#000000","#000000","#000000","#ffffff","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#000000","#EA0000","#EA0000","#EA0000","#EA0000","#EA0000","#000000","#FFDFBB","#FFDFBB","#FFDFBB","#000000","#FFDFBB","#FFDFBB","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#000000","#000000","#000000","#EA0000","#EA0000","#000000","#FFDFBB","#FFDFBB","#828282","#00BBFF","#FFDFBB","#FFDFBB","#FFDFBB","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#000000","#ffffff","#ffffff","#000000","#000000","#FFDFBB","#FFDFBB","#FFDFBB","#FFDFBB","#FFDFBB","#FFDFBB","#FFDFBB","#000000","#FFFFFF","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#ffffff","#ffffff","#000000","#FFDFBB","#828282","#FFDFBB","#EA0000","#EA0000","#FFDFBB","#FFDFBB","#FFDFBB","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#ffffff","#ffffff","#000000","#FFDFBB","#00BBFF","#FFDFBB","#EA0000","#EA0000","#FFDFBB","#000000","#FFDFBB","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#FFDFBB","#FFDFBB","#FFDFBB","#FFDFBB","#FFDFBB","#000000","#FFDFBB","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#FFDFBB","#FFDFBB","#FFDFBB","#FFDFBB","#000000","#000000","#FFDFBB","#FFDFBB","#000000","#00D300","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#FFDFBB","#FFDFBB","#000000","#FFDFBB","#FFDFBB","#FFDFBB","#FFDFBB","#000000","#00D300","#00D300","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#ffffff","#000000","#000000","#000000","#000000","#00D300","#00D300","#000000","#EA0000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#00D300","#000000","#EA0000","#EA0000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#EA0000","#EA0000","#000000","#00BBFF","#00BBFF","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#000000","#FFFFFF","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#C7C7C7","#C7C7C7","#717171","#717171","#717171","#717171","#717171","#717171","#717171","#717171","#717171","#C7C7C7","#C7C7C7","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#C7C7C7","#717171","#717171","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#ffffff","#C7C7C7","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#C7C7C7","#717171","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#ffffff","#C7C7C7","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#C7C7C7","#717171","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#ffffff","#C7C7C7","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#C7C7C7","#717171","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#ffffff","#C7C7C7","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#C7C7C7","#717171","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#ffffff","#C7C7C7","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#C7C7C7","#717171","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#DFDFFF","#ffffff","#C7C7C7","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#C7C7C7","#C7C7C7","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#C7C7C7","#C7C7C7","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#C7C7C7","#00D300","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#000000","#000000","#000000","#000000","#000000","#C7C7C7","#C7C7C7","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#C7C7C7","#EA0000","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#FFFFFF","#C7C7C7","#FFFFFF","#C7C7C7","#FFFFFF","#C7C7C7","#C7C7C7","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#C7C7C7","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#FFFFFF","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"]
    ]);

    IconMask.replace_artboard_array([
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#000000","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#FFFFFF","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#FFFFFF","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#FFFFFF","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],
	["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"]
    ]);
}
    </script>

</body></html>
