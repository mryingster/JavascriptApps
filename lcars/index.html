<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>LCARS</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="height=320" />
    <style type="text/css">
body {
    background-color: #000;
}

@font-face {
    font-family: "lcars";
    src: url('fonts/swiss_911.ttf') format('truetype');
}
    </style>
  </head>
    <body onload=start();>

      <svg width="100%" height="100%" viewBox="0 0 480 320" version="1.1"
           xmlns="http://www.w3.org/2000/svg"
           xmlns:xlink="http://www.w3.org/1999/xlink"
           xml:space="preserve"
           xmlns:serif="http://www.serif.com/"
           style="width:100%; height:100%; position:fixed; top:0; left:0; z-index:1; fill-rule:evenodd; clip-rule:evenodd; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:1.5; background-color:#000;">

	<g id="diag_data" transform="matrix(1,0,0,1,75,180)" style="display:none;">
	  <image x="0" y="0" width="380" height="150" xlink:href="diagram.svg" />
	</g>

	<!-- Starfleet Emblem -->
	<path d="M435.157,249.391C436.202,249.514 436.712,250.665 437.257,251.65C441.411,259.16 443.855,267.591 446.268,275.984C447.937,281.788 449.461,287.634 450.798,293.518C450.798,293.518 450.884,294.133 450.808,294.407C450.79,294.471 450.747,294.526 450.707,294.579C450.104,295.39 448.72,294.923 448.248,293.81C446.19,288.962 444.314,284.01 441.371,279.702C440.492,278.416 439.366,277.162 437.946,276.919C436.162,276.614 434.589,278.123 433.147,279.502C428.873,283.587 425.562,288.598 422.379,293.639C421.407,295.192 419.238,295.517 419.348,293.671C419.348,293.671 419.532,292.834 419.669,292.241C422.678,279.463 425.917,266.507 431.326,254.811C432.121,253.092 432.817,251.219 434.109,249.906C434.387,249.623 434.571,249.367 435.157,249.391ZM435.076,250.712C434.945,250.834 434.829,250.971 434.72,251.113C433.201,253.085 432.324,255.538 431.334,257.91C426.577,269.31 423.443,281.416 420.661,293.508L420.611,293.728C421.087,293.735 421.289,293.019 421.624,292.491C425.207,286.891 428.79,280.96 434.089,277.053C435.371,276.109 436.982,275.267 438.653,275.808C441.321,276.671 442.969,279.712 444.356,282.389C446.203,285.954 447.841,289.647 449.4,293.321C449.434,293.399 449.458,293.479 449.5,293.557C449.574,293.687 449.387,292.97 449.284,292.526C446.22,279.513 443.1,266.386 437.223,254.308C436.609,253.046 436.096,251.646 435.097,250.712C435.097,250.712 435.096,250.694 435.076,250.712ZM444.715,287.992C444.879,288.346 445.044,288.707 445.211,289.069C442.072,290.146 438.483,290.757 434.671,290.757C431.617,290.757 428.706,290.365 426.056,289.655C426.294,289.313 426.533,288.972 426.774,288.633C429.211,289.255 431.877,289.598 434.671,289.598C438.311,289.598 441.734,289.016 444.715,287.992ZM426.808,263.161C426.646,263.602 426.486,264.046 426.329,264.492C418.928,266.509 413.754,271.128 413.754,276.504C413.754,280.236 416.249,283.604 420.252,285.99C420.154,286.399 420.056,286.809 419.958,287.218C415.302,284.606 412.363,280.774 412.363,276.504C412.363,270.4 418.368,265.192 426.808,263.161ZM443.529,263.418C451.442,265.608 456.978,270.642 456.978,276.504C456.978,280.538 454.355,284.18 450.14,286.773C450.042,286.354 449.944,285.935 449.846,285.516C453.404,283.168 455.588,279.995 455.588,276.504C455.588,271.376 450.88,266.937 444.024,264.788C443.862,264.33 443.697,263.873 443.529,263.418Z" style="fill:rgb(60,60,60);fill-rule:nonzero;"/>

	<!-- LCARS Boxes-->
	<g id="header" transform="matrix(1,0,0,1,10,10)"  onclick="fullscreen()">
          <path d="M451.058,0C455.999,0.032 460,4.052 460,9C460,13.967 455.967,18 451,18C451,18 82,18 82,18C75.377,18 70,23.377 70,30L70,36L18,36L0,36L0,18C0,8.066 8.065,0 18,0L451,0L451.058,0Z" style="fill:rgb(151,120,142);"/>
          <rect x="382" y="-1" width="67" height="20"/>
	  <text x="385px" y="018px" style="font-family:'lcars', sans-serif;font-size:24px;fill:rgb(255,207,109);">LCARS 1.0</text>
	</g>
	<g id="button_time" transform="matrix(1,0,0,1,10,48)" onclick="toggleTimeFormat()">
          <rect x="0" y="0" width="70" height="36" style="fill:rgb(255,207,109);"/>
	  <text x="065px" y="032px" style="font-family:'lcars', sans-serif;font-size:12px;fill:rgb(0,0,0);text-anchor:end;">TIME</text>
	</g>
	<g id="button_date" transform="matrix(1,0,0,1,10,86)" onclick="toggleDateFormat()">
          <rect x="0" y="0" width="70" height="36" style="fill:rgb(255,207,109);"/>
	  <text x="065px" y="032px" style="font-family:'lcars', sans-serif;font-size:12px;fill:rgb(0,0,0);text-anchor:end;">DATE</text>
	</g>
	<G id="blank_1" transform="matrix(1,0,0,1,10,124)">
          <path d="M0,18L0,0L70,0L70,16C70,22.623 75.377,28 82,28L460,28L460,36L70,36L18,36C8.066,36 0,27.934 0,18Z" style="fill:rgb(208,195,224);"/>
	  <text x="065px" y="032px" style="font-family:'lcars', sans-serif;font-size:12px;fill:rgb(0,0,0);text-anchor:end;"></text>
	</g>

	<G id="blank_2" transform="matrix(1,0,0,1,10,162)">
          <path d="M0,18L0,36L70,36L70,20C70,13.377 75.377,8 82,8L460,8L460,0L70,0L18,0C8.066,0 0,8.066 0,18Z" style="fill:rgb(151,120,142);"/>
	  <text x="065px" y="032px" style="font-family:'lcars', sans-serif;font-size:12px;fill:rgb(0,0,0);text-anchor:end;"></text>
	</g>
	<g id="button_geo" transform="matrix(1,0,0,1,10,200)" onclick="switchModeGeo()">
          <rect x="0" y="0" width="70" height="36" style="fill:rgb(255,207,109);"/>
	  <text x="065px" y="032px" style="font-family:'lcars', sans-serif;font-size:12px;fill:rgb(0,0,0);text-anchor:end;">GEO</text>
	</g>
	<g id="button_diag" transform="matrix(1,0,0,1,10,238)" onclick="switchModeDiag()">
          <rect x="0" y="0" width="70" height="36" style="fill:rgb(255,207,109);"/>
	  <text x="065px" y="032px" style="font-family:'lcars', sans-serif;font-size:12px;fill:rgb(0,0,0);text-anchor:end;">DIAG</text>
	</g>
	<g id="button_sleep" transform="matrix(1,0,0,1,10,276)" onclick="sleep()">
	  <path d="M18,36C8.066,36 0,27.934 0,18L0,0L70,0L70,36L18,36Z" style="fill:rgb(255,170,0);"/>
	  <text x="065px" y="032px" style="font-family:'lcars', sans-serif;font-size:12px;fill:rgb(0,0,0);text-anchor:end;">POWER</text>
	</g>

	<!--
	<g id="" transform="matrix(1,0,0,1,0,0)" onclick="">
          <path d="M70,12C70,5.377 64.623,0 58,0L12,0C5.377,0 0,5.377 0,12C0,18.623 5.377,24 12,24L58,24C64.623,24 70,18.623 70,12Z" style="fill:rgb(27,15,255);"/>
	  <text x="060px" y="016px" style="font-family:'lcars', sans-serif;font-size:8px;fill:rgb(0,0,0);text-anchor:end;">EXIT</text>
	</g>
	<g id="" transform="matrix(1,0,0,1,0,0)" onclick="">
          <path d="M70,12C70,5.377 64.623,0 58,0L12,0C5.377,0 0,5.377 0,12C0,18.623 5.377,24 12,24L58,24C64.623,24 70,18.623 70,12Z" style="fill:rgb(27,15,255);"/>
          <circle cx="12" cy="12" r="3"/>
	  <text x="060px" y="016px" style="font-family:'lcars', sans-serif;font-size:8px;fill:rgb(0,0,0);text-anchor:end;">SOUND</text>
	</g>
	-->

	<!-- Text -->
      <text x="275px" y="110px" style="font-family:'lcars', sans-serif;font-size:90px;fill:rgb(255,170,0);" id="time" text-anchor="middle">12:00:00 AM</text>
      <text x="275px" y="140px" style="font-family:'lcars', sans-serif;font-size:24px;fill:rgb(255,207,109);" id="date" text-anchor="middle">Monday, January 1, 2019</text>

      <g id="geo_data" transform="matrix(1,0,0,1,110,213)">
	<text x="0px" y="0px" style="font-family:'lcars', sans-serif;font-size:24px;fill:rgb(255,170,0);" id="city">Unable to locate</text>

	<!-- Weather labels -->
	<text x="0px" y="20px" style="font-family:'lcars', sans-serif;font-size:18px;fill:rgb(255,207,109);">Weather:</text>
	<text x="0px" y="40px" style="font-family:'lcars', sans-serif;font-size:18px;fill:rgb(255,207,109);">Temperature:</text>
	<text x="0px" y="60px" style="font-family:'lcars', sans-serif;font-size:18px;fill:rgb(255,207,109);">Humidity:</text>
	<text x="0px" y="80px" style="font-family:'lcars', sans-serif;font-size:18px;fill:rgb(255,207,109);">Wind:</text>

	<!-- Weather Data -->
	<text x="80px" y="20px" style="font-family:'lcars', sans-serif;font-size:18px;fill:rgb(255,207,109);" id="desc">No Data</text>
	<text x="80px" y="40px" style="font-family:'lcars', sans-serif;font-size:18px;fill:rgb(255,207,109);" id="temp">No Data</text>
	<text x="80px" y="60px" style="font-family:'lcars', sans-serif;font-size:18px;fill:rgb(255,207,109);" id="humid">No Data</text>
	<text x="80px" y="80px" style="font-family:'lcars', sans-serif;font-size:18px;fill:rgb(255,207,109);" id="wind">No Data</text>
      </g>

      
      <g id="screen_dim" style="display:none;" onclick="wake()">
	<rect x="0" y="0" width="480" height="320" opacity="0.5" style="fill:rgb(0,0,0);"/>
	<path d="M480,0L480,320L0,320L0,0L480,0ZM470,37.108L90.32,37.108L90.32,145L470,145L470,37.108Z" opacity="0.8" style="fill:rgb(0,0,0);"/>
      </g>

    </svg>

    <script type="text/javascript">

var time_style = 0;
var date_style = 0;

function toggleTimeFormat() {
    time_style += 1;
    if (time_style > 3) {
	time_style = 0
    }
    update_clock();
}

function toggleDateFormat() {
    date_style += 1;
    if (date_style > 3) {
	date_style = 0
    }
    update_clock();
}

function switchModeGeo() {
    var geo_data = document.getElementById('geo_data');
    var diag_data = document.getElementById('diag_data');
    if (geo_data.style.display == "") {
	getLocation();
    }
    geo_data.style.display = "";
    diag_data.style.display = "None";
}

function switchModeDiag() {
    var geo_data = document.getElementById('geo_data');
    var diag_data = document.getElementById('diag_data');
    geo_data.style.display = "None";
    diag_data.style.display = "";
}

function sleep() {
    document.getElementById('screen_dim').style.display = "";
}

function wake() {
    document.getElementById('screen_dim').style.display = "None";
}
      
function update_clock() {
    var date_time = new Date();
    var date_string = "None"
    var day = date_time.getDay();
    var date = date_time.getDate();
    var month = date_time.getMonth() + 1;
    var year = date_time.getFullYear();

    // Date Style 0 = Normal Date String
    if (date_style == 0) {
	day = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"][day]
	month = ["", "January","February","March","April","May","June","July","August","September","October","November","December"][month]
	date_string = day+", "+month+" "+date+", "+year
    }

    // Date Style 1 = Stardate
    if (date_style == 1) {
	var year_start = new Date(date_time.getFullYear(), 0, 0);
	var year_end   = new Date(date_time.getFullYear()+1, 0, 0);
	var year_len   = year_end  - year_start;
	var time_diff  = date_time - year_start;

	var sd_year = year-1900;
	var sd_date = Math.round(time_diff / year_len * 10000) / 100;
	if (sd_date < 10) {
	    sd_date = "0"+sd_date;
	}
	date_string = sd_year+""+sd_date;
    }

    // Date Style 2 = ISO
    if (date_style == 2) {
	date_string = year + "-" + month + "-" + date
    }

    // Date Style 3 = Linux EPOC
    if (date_style == 3) {
	date_string = date_time.getTime();
    }

    document.getElementById('date').innerHTML = date_string;

    var time_string = "None";
    var hours = date_time.getHours();
    var minutes = date_time.getMinutes();
    var seconds = date_time.getSeconds();

    if (minutes < 10) {
        minutes = "0"+minutes;
    }
    if (seconds < 10) {
        seconds = "0"+seconds;
    }

    // Time Style 0, 1 = 12 Hour
    // Time Style 2, 3 = 24 Hour
    var meridiem = "";
    if (time_style < 2) {
	meridiem = " AM";
	if (hours > 11) {
            meridiem = " PM";
	}
	if (hours > 12) {
            hours -= 12;
	}
	if (hours == 0) {
	    hours = 12;
	}
    }

    // Time Style 1, 3 = Flash Separator
    var separator = ":";
    if (time_style % 2 != 0) {
	if (seconds % 2 != 0) {
	    separator = " ";
	}
    }

    time_string = hours+separator+minutes+separator+seconds+meridiem
    document.getElementById('time').innerHTML = time_string;

    // Update weather hourly
    if (minutes == "00" && seconds == "01") {
        getLocation();
    }
}

function nextLoop() {
    var refresh = 1000;
    update_clock();
    mytime = setTimeout(function() { nextLoop() }, refresh);
}

function httpGetAsync(theUrl, callback)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() { 
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
            callback(xmlHttp.responseText);
    }
    xmlHttp.open("GET", theUrl, true); // true for asynchronous 
    xmlHttp.send(null);
}

function getWeather(lat, lon) {
    var api = "7c0606acc5d2bf023d4188f3233ccf61";
    var CurrentWeatherURL = "https://api.openweathermap.org/data/2.5/weather?lat="+lat+"&lon="+lon+"&appid="+api+"&units=imperial"
    httpGetAsync(CurrentWeatherURL, updateWeather);
}

function getLocation() {
    navigator.geolocation.getCurrentPosition(geolocate_success, geolocate_fail);
}

function geolocate_success(pos) {
    getWeather(pos.coords.latitude, pos.coords.longitude);
    
}

function geolocate_fail() {
    console.log("Failed to get geolocation");
    var LocationURL = "https://json.geoiplookup.io/api"
    httpGetAsync(LocationURL, updateLocation);
}

function updateLocation(data_in) {
    var location_data = JSON.parse(data_in);
    getWeather(location_data.latitude, location_data.longitude);
}

function updateWeather(data_in) {
    var weather_data = JSON.parse(data_in);
    //console.log(weather_data);
    var deg_to_dir = ["N", "NNE", "NE", "ENE", "E", "ESE", "SE", "SSE",
                      "S", "SSW", "SW", "WSW", "W", "WNW", "NW", "NNW"]
    
    var location_string = weather_data.name.toUpperCase() + " (" + weather_data.coord.lat + ", " + weather_data.coord.lon + ")";
    var weather_string  = weather_data.weather[0].main;
    var temp_string     = weather_data.main.temp + "&deg;F (High: " + weather_data.main.temp_max + "&deg;F, Low: " + weather_data.main.temp_min + "&deg;F)";
    var humidity_string = weather_data.main.humidity + "%";
    var wind_string     = weather_data.wind.speed + " MPH";

    // Add direction if available
    if (weather_data.wind.deg < 361) {
        var wind_string     = deg_to_dir[Math.floor(weather_data.wind.deg/22.5)]+ " " + wind_string;
    }

    document.getElementById('city').innerHTML    = location_string;
    document.getElementById('desc').innerHTML    = weather_string;
    document.getElementById('temp').innerHTML    = temp_string;
    document.getElementById('humid').innerHTML   = humidity_string;
    document.getElementById('wind').innerHTML    = wind_string;
}

function fullscreen(){
    if ((document.fullScreenElement && document.fullScreenElement !== null) ||  // alternative standard method
	(!document.mozFullScreen && !document.webkitIsFullScreen)) {            // current working methods
	if (document.documentElement.requestFullScreen) {
	    document.documentElement.requestFullScreen();
	} else if (document.documentElement.mozRequestFullScreen) {
	    document.documentElement.mozRequestFullScreen();
	} else if (document.documentElement.webkitRequestFullScreen) {
	    document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
	}
    } else {
	if (document.cancelFullScreen) {
	    document.cancelFullScreen();
	} else if (document.mozCancelFullScreen) {
	    document.mozCancelFullScreen();
	} else if (document.webkitCancelFullScreen) {
	    document.webkitCancelFullScreen();
	}
    }
}

function start() {
    nextLoop();
    getLocation();
}

    </script>
  </body>
</html>
